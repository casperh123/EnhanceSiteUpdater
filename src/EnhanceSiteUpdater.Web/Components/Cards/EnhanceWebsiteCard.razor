@using Enhance.Client.Models
@using EnhanceSiteUpdater.Web.Components.Badge
@using EnhanceSiteUpdater.Core.Entities
@using EnhanceSiteUpdater.Core.Repository
@using EnhanceSiteUpdater.Infrastructure.EntityHelpers
@inject IWebsiteRepository WebsiteRepository

<RadzenCard >
    <RadzenRow Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.SpaceBetween" AlignItems="AlignItems.Center">
        <RadzenColumn>
            <RadzenText TextStyle="TextStyle.H4">
                @EnhanceWebsite.Domain.Domain
            </RadzenText>
            <EnhanceWebsiteKindBadge Kind="@EnhanceWebsite.Kind"/>
        </RadzenColumn>
        <RadzenColumn>
            <RadzenText>
                Added:
            </RadzenText>
            @if (_website.MaintenanceType != MaintenanceType.None)
            {
                <RadzenIcon Icon="done" IconColor="@Colors.Success" />
            }
            else
            {
                <RadzenIcon Icon="dangerous" IconColor="@Colors.Danger" />
            }
        </RadzenColumn>
        
        <RadzenStack>
            <RadzenText TextStyle="TextStyle.Body1">
                Maintenance Plan:
            </RadzenText>
            <RadzenDropDown @bind-Value="@_website.MaintenanceType" Data="_maintenanceTypes" Change="@MaintenanceChanged"></RadzenDropDown>
        </RadzenStack>
        
    </RadzenRow>
</RadzenCard>

@code {
    
    [Parameter]
    public Website EnhanceWebsite { get; set; }
    
    [Parameter]
    public EventCallback<UpdaterWebsite> WebsiteChanged { get; set; }
    
    private UpdaterWebsite _website { get; set; }
    private List<MaintenanceType> _maintenanceTypes = Enum.GetValues<MaintenanceType>().ToList();
    
    protected override async Task OnInitializedAsync()
    {
        _website = await WebsiteRepository.Get(EnhanceWebsite.Domain.Domain) ?? 
                   new UpdaterWebsite(
                       EnhanceWebsite.Domain.Domain, 
                       KindConverter.FromEnhance(EnhanceWebsite.Kind ?? WebsiteKind.Normal), 
                       MaintenanceType.None
                   );
    }

    private async Task MaintenanceChanged()
    {
        await WebsiteChanged.InvokeAsync(_website);
    }
}